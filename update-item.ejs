<%- include('partials/header', {title: 'Pantry+ Update Item', user: user}) %>

<h1 style="font-size: 55px; margin-top: 50px; font-weight: bolder;">Update Item</h1>

<h4 style="margin-top: 20px; font-weight:lighter;">Edit an existing inventory item</h4>

<div class="d-flex justify-content-center" style="margin-top: 20px;">
    <div class="card" style="width: 50%;">
        <form action="/api/update-item-33968748" method="GET">
                        <input type="hidden" name="userId" value="<%= user.userId %>">

            <div class="card-body" style="text-align: start; padding: 20px;">
                <h4>Select Item to Update</h4>
                <div style="width: 50%;">
                    <label for="itemSelect" class="form-label">Select from List</label>
                    <select name="inventoryId" id="itemSelect" class="form-select" required onchange="this.form.submit()">
                        <option value="" selected disabled>Select from the items below</option>
                        <% inventory.forEach(item => { %>
                            <option value="<%=item.inventoryId%>" <%= (selectedItem && item.inventoryId === selectedItem.inventoryId) ? "selected" : ""%>>
                                <%=item.inventoryId%> - <%=item.ingredientName%>
                            </option>
                        <% }) %>
                    </select>
                </div>
            </div>
        </form>

        <% if (selectedItem) { %>
        <form action="/api/update-item-33968748?userId=<%=user.userId%>" method="POST">
            <div class="card-body" style="text-align: start; padding: 20px;">
                <input type="hidden" name="inventoryId" value="<%= selectedItem.inventoryId %>">
                
                <h4>Item Details</h4>
                <div class="row g-3">
                    <div class="col-md-12">
                        <label for="ingredientName" class="form-label">Ingredient Name</label>
                        <input type="text" class="form-control" id="ingredientName" name="ingredientName" 
                               value="<%= selectedItem.ingredientName %>" readonly disabled>
                    </div>
                </div>

                <h4 class="mt-3">Update Information</h4>
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="quantity" class="form-label">Quantity</label>
                        <input type="number" step="0.01" class="form-control" id="quantity" name="quantity" 
                               required value="<%= selectedItem.quantity %>">
                    </div>
                    <div class="col-md-6">
                        <label for="unit" class="form-label">Unit</label>
                        <select name="unit" id="unit" class="form-select" required>
                            <option value="pieces" <%= selectedItem.unit === 'pieces' ? 'selected' : '' %>>pieces</option>
                            <option value="kg" <%= selectedItem.unit === 'kg' ? 'selected' : '' %>>kilogram</option>
                            <option value="g" <%= selectedItem.unit === 'g' ? 'selected' : '' %>>gram</option>
                            <option value="liters" <%= selectedItem.unit === 'liters' ? 'selected' : '' %>>liters</option>
                            <option value="ml" <%= selectedItem.unit === 'ml' ? 'selected' : '' %>>milliliters</option>
                            <option value="cups" <%= selectedItem.unit === 'cups' ? 'selected' : '' %>>cups</option>
                            <option value="tbsp" <%= selectedItem.unit === 'tbsp' ? 'selected' : '' %>>tablespoons</option>
                            <option value="tsp" <%= selectedItem.unit === 'tsp' ? 'selected' : '' %>>teaspoons</option>
                            <option value="dozen" <%= selectedItem.unit === 'dozen' ? 'selected' : '' %>>dozen</option>
                        </select>
                    </div>
                </div>

                <div class="row g-3 mt-2">
                    <div class="col-md-6">
                        <label for="location" class="form-label">Location</label>
                        <select name="location" id="location" class="form-select" required>
                            <option value="Fridge" <%= selectedItem.location === 'Fridge' ? 'selected' : '' %>>Fridge</option>
                            <option value="Freezer" <%= selectedItem.location === 'Freezer' ? 'selected' : '' %>>Freezer</option>
                            <option value="Pantry" <%= selectedItem.location === 'Pantry' ? 'selected' : '' %>>Pantry</option>
                            <option value="Counter" <%= selectedItem.location === 'Counter' ? 'selected' : '' %>>Counter</option>
                            <option value="Cupboard" <%= selectedItem.location === 'Cupboard' ? 'selected' : '' %>>Cupboard</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="cost" class="form-label">Cost (per unit)</label>
                        <input type="number" step="0.01" class="form-control" id="cost" name="cost" 
                               required value="<%= selectedItem.cost %>">
                    </div>
                </div>

                <div class="row g-3 mt-2">
                    <div class="col-md-6">
                        <label for="purchaseDate" class="form-label">Purchase Date</label>
                        <input type="text" class="form-control" id="purchaseDate" name="purchaseDate" 
                               placeholder="YYYY-MM-DD" required value="<%= selectedItem.purchaseDate.toISOString().split("T")[0]; %>">
                    </div>
                    <div class="col-md-6">
                        <label for="expirationDate" class="form-label">Expiration Date</label>
                        <input type="text" class="form-control" id="expirationDate" name="expirationDate" 
                               placeholder="YYYY-MM-DD" required value="<%= selectedItem.expirationDate.toISOString().split("T")[0]; %>">
                    </div>
                </div>

                <% if (errors && errors.length > 0) { %>
                <div style="color: red; margin-top: 1em;">
                    <ul>
                        <% errors.forEach(function(err) { %>
                        <li><%= err %></li>
                        <% }) %>
                    </ul>
                </div>
                <% } %>

                <div class="container d-flex justify-content-end mt-3">
                    <div>
                        <a href="/api/all-items-33968748?userId=<%=user.userId%>" class="btn q-action-button" style="--border-color:black">Back to Inventory</a>
                        <a href="/api/update-item-33968748?userId=<%=user.userId%>" class="btn q-action-button" style="--border-color:blue">Reset Selection</a>
                        <button type="submit" class="btn my-button" style="font-size: 18px;">Update Item</button>
                    </div>
                </div>
            </div>
        </form>
        <% } %>
    </div>
</div>

<%- include('partials/footer', {pageName: "Update Item"}) %>